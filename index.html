<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Vehicle Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>#map { height: 100vh; }</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const FIREBASE_URL = "https://overspeed-23311-default-rtdb.asia-southeast1.firebasedatabase.app/vehicle.json"; // update 
let map = L.map('map').setView([0,0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);
let marker = null;

async function fetchLocation(){
  try {
    const r = await fetch(FIREBASE_URL);
    const data = await r.json();
    if (!data || !data.lat || !data.lon) return;
    const lat = data.lat;
    const lon = data.lon;
    const speed = data.speed_kmh;
    const time = data.time;
    if (!marker) {
      marker = L.marker([lat, lon]).addTo(map);
      marker.bindPopup(`Speed: ${speed} km/h<br/>${time}`);
      map.setView([lat, lon], 16);
    } else {
      marker.setLatLng([lat, lon]);
      marker.setPopupContent(`Speed: ${speed} km/h<br/>${time}`);
    }
  } catch (e) {
    console.error("Fetch error", e);
  }
}

// refresh every 4 seconds
setInterval(fetchLocation, 4000);
fetchLocation();
</script>
</body>
</html>
